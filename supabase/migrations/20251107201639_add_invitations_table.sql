/*\n  # Add Trip Invitations Table\n\n  1. New Table\n    - `trip_invitations`\n      - `id` (uuid, primary key)\n      - `trip_id` (uuid, foreign key to trips)\n      - `email` (text, email to invite)\n      - `invited_by` (uuid, user who sent invitation)\n      - `status` (text, 'pending' | 'accepted' | 'declined')\n      - `token` (text, unique token for invitation link)\n      - `created_at` (timestamptz)\n      - `expires_at` (timestamptz)\n\n  2. Indexes\n    - Index on token for fast lookup\n    - Index on email for checking existing invitations\n    - Index on trip_id for listing invitations\n\n  3. Security\n    - RLS disabled (auth.uid() doesn't work in this project)\n*/\n\n-- Create invitations table\nCREATE TABLE IF NOT EXISTS public.trip_invitations (\n  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n  trip_id UUID NOT NULL REFERENCES public.trips(id) ON DELETE CASCADE,\n  email TEXT NOT NULL,\n  invited_by UUID NOT NULL,\n  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'accepted', 'declined')),\n  token TEXT NOT NULL UNIQUE DEFAULT encode(gen_random_bytes(32), 'hex'),\n  created_at TIMESTAMPTZ DEFAULT now(),\n  expires_at TIMESTAMPTZ DEFAULT (now() + interval '7 days'),\n  \n  -- Prevent duplicate pending invitations\n  UNIQUE(trip_id, email, status)\n);
\n\n-- Create indexes\nCREATE INDEX IF NOT EXISTS idx_trip_invitations_token ON public.trip_invitations(token);
\nCREATE INDEX IF NOT EXISTS idx_trip_invitations_email ON public.trip_invitations(email);
\nCREATE INDEX IF NOT EXISTS idx_trip_invitations_trip_id ON public.trip_invitations(trip_id);
\n\n-- Disable RLS (auth.uid() doesn't work)\nALTER TABLE public.trip_invitations DISABLE ROW LEVEL SECURITY;
\n\n-- Add comment\nCOMMENT ON TABLE public.trip_invitations IS 'Stores trip invitations sent via email. RLS disabled due to auth.uid() issues.';
\n;
