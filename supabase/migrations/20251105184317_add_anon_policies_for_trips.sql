/*\n  # Add Policies for Anonymous (Authenticated) Users\n\n  ## Problem\n  The client is sending requests with the anon key, and even though users\n  are authenticated, Supabase is treating them as the 'anon' role instead\n  of the 'authenticated' role.\n\n  ## Solution\n  Add duplicate policies for the 'anon' role that mirror the 'authenticated'\n  policies. This is a workaround for when the JWT doesn't properly elevate\n  the role from anon to authenticated.\n\n  ## Changes\n  1. Add INSERT policy for anon role (with proper owner_id check)\n  2. Add SELECT policy for anon role\n  3. Add UPDATE policy for anon role\n  4. Add DELETE policy for anon role\n*/\n\n-- INSERT: Anon users can create trips (if they have a valid auth.uid())\nCREATE POLICY "anon_can_insert_trips"\n  ON public.trips\n  FOR INSERT\n  TO anon\n  WITH CHECK (\n    auth.uid() IS NOT NULL \n    AND owner_id = auth.uid()\n  );
\n\n-- SELECT: Anon users can view trips they are members of\nCREATE POLICY "anon_can_view_trips"\n  ON public.trips\n  FOR SELECT\n  TO anon\n  USING (\n    EXISTS (\n      SELECT 1 FROM trip_members\n      WHERE trip_members.trip_id = trips.id\n        AND trip_members.user_id = auth.uid()\n    )\n  );
\n\n-- UPDATE: Anon users can update their own trips\nCREATE POLICY "anon_can_update_trips"\n  ON public.trips\n  FOR UPDATE\n  TO anon\n  USING (auth.uid() = owner_id)\n  WITH CHECK (auth.uid() = owner_id);
\n\n-- DELETE: Anon users can delete their own trips\nCREATE POLICY "anon_can_delete_trips"\n  ON public.trips\n  FOR DELETE\n  TO anon\n  USING (auth.uid() = owner_id);
\n;
